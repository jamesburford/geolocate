<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="msapplication-tap-highlight" content="no" />
		<!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
		<meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no' />
		<meta http-equiv="Content-Security-Policy" content="content_security_policy": "script-src 'self' https://maps.googleapis.com https://maps.gstatic.com; object-src 'self'" />
		<title>GPS Countdown</title>

		<!-- JB - A CDN was not used due to needing functionality without internet connection or unnecessarily using user data allowance. Referenced from https://jquerymobile.com/download/   -->
		<script src="js/jquery-1.10.2.min.js"></script>
		<script src="js/jquery.mobile-1.4.5.min.js"></script>
		<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
		
    
	</head>

	<!-- JB - This refreshes the map from the users location compared to the default location rather than using the default Google Maps location. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation  -->
	<body onhashchange="refreshMap()">
		<div data-role="page" id="home">
			<div data-role="header">
				<h1 text-align="center">
					<img src="images/logo.png" alt="Logo" style="margin-top:10px;" width="120px">
				</h1>
			</div>

			<div role="main" class="ui-content">
				<h1 id="welcome"></h1>
				<h4>Please follow the instructions underneath to set your time and location.</h4>
				<p align="center">
					<p>Click the timer to continue to the next page</p>
				<div style="text-align:center;"><a href="#timer"><img src="images/time.png" alt="Logo" width="80" align="center"></a></div>
				</p>
			</div>

			<div data-role="footer" style="text-align:center;">
			<a href="#defaultpanel"><img src="images/3lines.png" alt="Menu" width="20" /><p>Open Menu<p></a>
			</div>

			<!-- defaultpanel  -->
			<div data-role="panel" id="defaultpanel" data-theme="b">
				<div class="panel-content">
					<h3>Default panel options</h3>
					<p><a href="#home">Home</a></p>
					<p><a href="#timer">Timer</a></p>
					<p>&nbsp;</p>
					<p><a href="#about">About</a></p>
					<p><a href="#contact">Contact</a></p>
					<p>&nbsp;</p>
					<p>Swipe to close</p>
					<strong><p>Version 1.0</p></strong>
					<p>&nbsp;</p>
					<p><img src="images/whitelogo.png" alt="Logo" width="150"></p>

					<a href="#demo-links" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-inline="true">Close panel</a>
				</div><!-- /content wrapper for padding -->
			</div><!-- /defaultpanel -->
		</div>
		
		
			<div data-role="page" id="return">
			<div data-role="header">
				<h1 text-align="center">
					<img src="images/logo.png" alt="Logo" style="margin-top:10px;" width="120px">
				</h1>
			</div>

			<div role="main" class="ui-content">
				<h1>Welcome back</h1>
				<a href="#map"><button>Get directions to car</button></a>
				<br>
				<button id="startover">Start again</button>
			</div>
			<br>
			<br>

			<div data-role="footer" style="text-align:center;">
			<a href="#defaultpanel"><img src="images/3lines.png" alt="Menu" align="center" width="20" /><p>Open Menu<p></a>
			</div>

			<!-- defaultpanel  -->
			<div data-role="panel" id="defaultpanel" data-theme="b">
				<div class="panel-content">
					<h3>Default panel options</h3>
					<p><a href="#home">Home</a></p>
					<p><a href="#timer">Timer</a></p>
					<p>&nbsp;</p>
					<p><a href="#about">About</a></p>
					<p><a href="#contact">Contact</a></p>
					<p>&nbsp;</p>
					<p>Swipe to close</p>
					<strong><p>Version 1.0</p></strong>
					<p>&nbsp;</p>
					<p><img src="images/whitelogo.png" alt="Logo" width="150"></p>

					<a href="#demo-links" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-inline="true">Close panel</a>
				</div><!-- /content wrapper for padding -->
			</div><!-- /defaultpanel -->
		</div>
		
		<div data-role="page" id="timer">
			<div data-role="header">
				<h1 text-align="center">
					<img src="images/logo.png" alt="Logo" style="margin-top:10px;" width="120px">
				</h1>
			</div>

			<div role="main" class="ui-content">
				<h4>Set a time you want to wish to be back at</h4>
				<form>
					
			<!-- JB - This allows the user to select the time which triggers a notification. Referenced from http://www.javascriptkit.com/script/script2/alarm.shtml -->
					<div id="jsalarmclock">
						<div><span>Hour<select></select></span> <span>Minutes<select></select></span> </div>
						<p>Set notification time</p>
						<select id="notificationdelay"></select>
						<input type="button" value="Set alarm" id="submitbutton" /> <input type="reset" value="Clear alarm" id="resetbutton" />
					</div>
				</form>
				<p>&nbsp;</p>
				<hr>
				<p>&nbsp;</p>
				<a href="#map"><button>Continue to map</button></a>
				<p>&nbsp;</p>
			</div>

			<div data-role="footer" style="text-align:center;">
			<a href="#defaultpanel"><img src="images/3lines.png" alt="Menu" align="center" width="20" /><p>Open Menu<p></a>
			</div>

			<!-- defaultpanel  -->
			<div data-role="panel" id="defaultpanel" data-theme="b">
				<div class="panel-content">
					<h3>Default panel options</h3>
					<p><a href="#home">Home</a></p>
					<p><a href="#timer">Timer</a></p>
					<p>&nbsp;</p>
					<p><a href="#about">About</a></p>
					<p><a href="#contact">Contact</a></p>
					<p>&nbsp;</p>
					<p>Swipe to close</p>
					<strong><p>Version 1.0</p></strong>
					<p>&nbsp;</p>
					<p><img src="images/whitelogo.png" alt="Logo" width="150"></p>

					<a href="#demo-links" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-inline="true">Close panel</a>
				</div><!-- /content wrapper for padding -->
			</div><!-- /defaultpanel -->
		</div>

		<div data-role="page" id="map">
			<div data-role="header">
				<h1 text-align="center">
					<img src="images/logo.png" alt="Logo" style="margin-top:10px;" width="120px">
				</h1>
			</div>

			<div role="main" class="ui-content">
		<!-- JB - Map is displayed here. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation -->
				    <div id="map"></div>

			</div>

			<div data-role="footer" style="text-align:center;">
			<a href="#defaultpanel"><img src="images/3lines.png" alt="Menu" align="center" width="20" /><p>Open Menu<p></a>
			</div>

			<!-- defaultpanel  -->
			<div data-role="panel" id="defaultpanel" data-theme="b">
				<div class="panel-content">
					<h3>Default panel options</h3>
					<p><a href="#home">Home</a></p>
					<p><a href="#timer">Timer</a></p>
					<p>&nbsp;</p>
					<p><a href="#about">About</a></p>
					<p><a href="#contact">Contact</a></p>
					<p>&nbsp;</p>
					<p>Swipe to close</p>
					<strong><p>Version 1.0</p></strong>
					<p>&nbsp;</p>
					<p><img src="images/whitelogo.png" alt="Logo" width="150"></p>

					<a href="#demo-links" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-inline="true">Close panel</a>
				</div><!-- /content wrapper for padding -->
			</div><!-- /defaultpanel -->
		</div>

		<div data-role="page" id="about">
			<div data-role="header">
				<h1 text-align="center">
					<img src="images/logo.png" alt="Logo" style="margin-top:10px;" width="120px">
				</h1>
			</div>

			<div role="main" class="ui-content">
				<h1>About Geolocation</h1>
				<h4>Simplify your everyday life with Geolocation.</h4>
				<p>&nbsp;</p>
				<p>The GPS Countdown application allows you to set a location such as car parking and a time which you need to get back to that vehicle at.</p>
				<p>Once you set your location and time to get back to the set location, the application runs in the background with a notification appearing 15 minutes before you are needed back at that set location such as when your car parking expires. The application sets directions back to that original location, as a result of the application being based on Google Maps, live traffic information is available to ensure you get back in time. </p>
				<p>The Geolocation app enables you to set your location and the time you need to be back at your car, simply go and you will be notified when to return back to the vehicle and the best route back.</p>
				<p>Why choose the app?</p>
				<p><li>Easily open the app with a simplistic user interface</li></p>
				<p><li>Set a location of where you parked your vehicle</li></p>
				<p><li>Set a time you wish to return back to the set location.</li></p>
				<p><li>A audio, vibrating and visual notification will inform you when you need to be back at the set location.</li></p>
				<p>&nbsp;</p>
				<p>&nbsp;</p>
				<p>Continuing usage of GPS technologies running in the background could potentially lead to battery life shortening.</p>
				<p></p>
			</div>

			<div data-role="footer" style="text-align:center;">
			<a href="#defaultpanel"><img src="images/3lines.png" alt="Menu" align="center" width="20" /><p>Open Menu<p></a>
			</div>

			<!-- defaultpanel  -->
			<div data-role="panel" id="defaultpanel" data-theme="b">
				<div class="panel-content">
					<h3>Default panel options</h3>
					<p><a href="#home">Home</a></p>
					<p><a href="#timer">Timer</a></p>
					<p>&nbsp;</p>
					<p><a href="#about">About</a></p>
					<p><a href="#contact">Contact</a></p>
					<p>&nbsp;</p>
					<p>Swipe to close</p>
					<strong><p>Version 1.0</p></strong>
					<p>&nbsp;</p>
					<p><img src="images/whitelogo.png" alt="Logo" width="150"></p>

					<a href="#demo-links" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-inline="true">Close panel</a>
				</div><!-- /content wrapper for padding -->
			</div><!-- /defaultpanel -->
		</div>

		<div data-role="page" id="contact">
			<div data-role="header">
				<h1 text-align="center">
					<img src="images/logo.png" alt="Logo" style="margin-top:10px;" width="120px">
				</h1>
			</div>

			<div role="main" class="ui-content">
				<h1>Contact us</h1>
				<h4>Need any assistance?<h4>
				<h4>Found an error?</h4>
				<h4>We'd love to hear from you!</h4>
				<!-- JB -The contact form is available for users to contact the developers for feedback and support. The code is referenced from http://www.123contactform.com/html-contact-form/ -->
				<form id="contact_form" action="#" method="POST" enctype="multipart/form-data">
					<div class="row">
						<input id="name" class="input" placeholder="Your name" name="name" type="text" value="" size="30" /><br />
					</div>
					<div class="row">
						<input id="email" class="input" name="email" placeholder="Email address" type="text" value="" size="30" /><br />
					</div>
					<div class="row">
						<textarea id="message" class="input" placeholder="Message" name="message" rows="7" cols="30"></textarea><br />
					</div>
					<input id="submit_button" type="submit" value="Send email" />
				</form>
				<p>&nbsp;</p>
				<hr>
				<p>&nbsp;</p>
				<h3>Address information</h3>
				<a href="mailto:contact@gpscountdown.com"></a><p>Email address: contact@gpscountdown.com</p></a>
				<p>&nbsp;</p>
				<p>32 Example Road</p>
				<p>Springfield</p>
				<p>SP8 1LC</p>

				<p>&nbsp;</p>
			</div>

			<div data-role="footer" style="text-align:center;">
			<a href="#defaultpanel"><img src="images/3lines.png" alt="Menu" align="center" width="20" /><p>Open Menu<p></a>
			</div>

			<!-- defaultpanel  -->
			<div data-role="panel" id="defaultpanel" data-theme="b">
				<div class="panel-content">
					<h3>Default panel options</h3>
					<p><a href="#home">Home</a></p>
					<p><a href="#timer">Timer</a></p>
					<p>&nbsp;</p>
					<p><a href="#about">About</a></p>
					<p><a href="#contact">Contact</a></p>
					<p>&nbsp;</p>
					<p>Swipe to close</p>
					<strong><p>Version 1.0</p></strong>
					<p>&nbsp;</p>
					<p><img src="images/whitelogo.png" alt="Logo" width="150"></p>

					<a href="#demo-links" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-inline="true">Close panel</a>
				</div><!-- /content wrapper for padding -->
			</div><!-- /defaultpanel -->
		</div>

	<!-- JB - This section populates the hour dropdowns upto 23, minute dropdowns upto 59 and notification dropdowns upto 60. Some of the code is referenced from http://www.javascriptkit.com/script/script2/alarm.shtml -->

		<script type="text/javascript">
			function start() {
				$('#jsalarmclock select')[0].id = 'hour';
				$('#jsalarmclock select')[1].id = 'minute';
				for (var i = 0; i < 60; i++)
					{
					if (i < 24)
						$('#hour').append($('<option>',	{
							value: i,
							text: pad(i),
							selected: (new Date()).getHours() === i
						}));
					$('#minute').append($('<option>', {
						value: i,
						text: pad(i),
						selected: (new Date()).getMinutes() === i
					}));
					
					$('#notificationdelay').append($('<option>', {
						value: i +1,
						text: i +1
					}));
				}
			}
			
			
	<!-- JB - This makes single numbers appear with a 0 before for example 1 being 01. If the number is less than 10 add a leading 0 in, if the nuber is greater than 10 leave alone -->

			function pad(num) {
				return (num < 10) ? "0" + num : num;
			}
	
	<!-- JB - Displays the notification to inform the user that the car parking is nearly up in a notfication which the user has set. Referenced: https://github.com/katzer/cordova-plugin-local-notifications  -->

			function setNotification(time) {
				cordova.plugins.notification.local.schedule({
					title: "Car parking nearly up",
					text: "Car parking up shortly, use the map to make your way back to your vehicle.",
					at: time
				});
			}
	
	<!-- JB - If the button (link) is clicked this will disable the default functionality of the link and run the following code. The user inputed data is passed into the funcion converted into miliseconds to enable calculations since the UNIX EPOCH date. If the time selected is in the past it will add 24 hours. Resulting in sending the user a notification alert using the users phone in built notification popup -->

			$('#submitbutton').click(function(e) {
				e.preventDefault();
				$('#jsalarmclock select').attr('disabled','disabled');
				var t = new Date();
				t.setHours($('#hour').val());
				t.setMinutes($('#minute').val());
				t.setSeconds(0);

				var min = parseInt( $('#notificationdelay').val());
				var ms = min * 60000;
				var d = new Date(t - ms);
				if (d < (new Date())) d.setDate(d.getDate() + 1);
				setNotification(d);
				alert('Time has been set');
			});
			
	<!-- JB - Reset time button function. When fired this cancels notifications -->

			$('#resetbutton').click(function() {
				cordova.plugins.notification.local.cancelAll();
			});
		</script>
		
	<!-- JB - A CDN was not used due to needing functionality without internet connection or unnecessarily using user data allowance. Referenced from https://github.com/apache/cordova-js   -->
		<script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript" src="js/index.js"></script>
		
		
	<!-- JB - Displays a message to the user depending on the different times of day. Referenced from http://www.javascriptsource.com/time-date/good-morning-afternoon-and-evening-by-brad-jones-120319202500.html -->

		<script type="text/javascript">
			app.initialize();
			var myDate = new Date();
			// Hour is before noon
			if (myDate.getHours() < 12)
				$('#welcome').html("Good Morning!");
			// Hour is from noon to 5pm (actually to 5:59 pm)
			else if (myDate.getHours() >= 12 && myDate.getHours() <= 17)
				$('#welcome').html("Good Afternoon!");
			// The hour is after 5pm, so it is between 6pm and midnight
			else if (myDate.getHours() > 17 && myDate.getHours() <= 24)
				$('#welcome').html("Good Evening!");
			// The hour is not between 0 and 24, so something is wrong
			else
				$('#welcome').html("Welcome!");
				
		
		</script>
		
		
		
		
		
		
 		<script type="text/javascript">
 
 	// JB - If there is a location set then take the user to the return screen. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation

 			if (window.localStorage) 
				if (window.localStorage.getItem("InitialLocation") !== null)
					window.location.hash='#return';
	
	// JB - If the user clicks on the start over link this clears the local storage and dispays the home screen and reintialises the map. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
			$('#startover').click(function(){
				window.localStorage.clear();
				initMap();
				window.location.hash='#home';
			});		
					
				
	// JB - The initalise map function redraws the map and centres the map on the default location and zoom level. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
				
			// Note: This example requires that you consent to location sharing when
			// prompted by your browser. If you see the error "The Geolocation service
			// failed.", it means you probably did not give permission for the browser to
			// locate you.
			function initMap() {
				var map = new google.maps.Map(document.getElementById('map'), {
					center: {lat: -34.397, lng: 150.644},
					zoom: 18
				});
				
        // JB - This gets the geolocation from the user using the in built GPS from the current position of the user. Giving the latitute and longitude of the user. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
				google.maps.event.trigger(map, 'resize');
				// Try HTML5 geolocation.
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function(position) {
						var pos = {
							lat: position.coords.latitude,
							lng: position.coords.longitude
						};
						
		// JB - Checking to see if local storage is available on the device. If local storage is empty this sets the InitialLoation with the GPS position. Otherwise, set the pos variable (which is where the car is parked) and mark it as a destination and creates the return to car feature. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
						if (window.localStorage) {
							if (window.localStorage.getItem("InitialLocation") === null)
								window.localStorage.setItem("InitialLocation", JSON.stringify(pos));
							else {
								pos = JSON.parse(window.localStorage.getItem("InitialLocation"));
								var directionsService = new google.maps.DirectionsService();
								var directionsDisplay = new google.maps.DirectionsRenderer();
								directionsDisplay.setMap(map);
								directionsDisplay.setOptions({suppressMarkers:true});

		// JB - var start is the start location, which is the current location of the user. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
								var start = {
									lat: position.coords.latitude,
									lng: position.coords.longitude
								};
								
		// JB - arrow.png is the 'you are here' icon  which is a map marker. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
								var image = "http://maps.google.com/mapfiles/kml/shapes/arrow.png";
								var parkingMarker = new google.maps.Marker({
								position: start,
								map: map,
								icon: image
								});
								
		// JB - This is the start and end location. As this is a car parking application the mode of transport to get back to your parked car is walking. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
								var request = {
									origin:start,
									destination:pos,
									travelMode: google.maps.TravelMode.WALKING
								};
								
		// JB - Request the route, if all is okay display conetnet.
								directionsService.route(request, function(result, status) {
									if (status == google.maps.DirectionsStatus.OK) {
										directionsDisplay.setDirections(result);
									}
								});
							}
						}
						else {
							
		// JB - Otherwise an alert will pop up will be used to inform the user this map function cannot be used. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
							alert("No storage");
						}
						
		// JB - A marker image (a car park ion)  will be shown to show the user where they have parked the vehicle. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
						var image = "http://maps.google.com/mapfiles/kml/shapes/parking_lot.png";
						var parkingMarker = new google.maps.Marker({
							position: pos,
							map: map,
							icon: image
						});
						map.setCenter(pos);
					}, function() {
						alert("GPS location cannot be found.");
					});
				}
				else {
	// JB - An error message is displayed if GEO location is not allowed or enabled. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
					
					alert("GPS has not been enabled/allowed on this device");
				}
			}
	
	// JB - When the 'map' section is loaded the map container is refreshed after getting location coordinates. The Google Maps code is referenced from https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
			function refreshMap() {
				if (location.hash.substr(1) === "map") {
					setTimeout(function() {
						google.maps.event.trigger(map, 'resize');
					}, 500);
				}
			}
		</script>
		<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB4uyz3-pk1FffmFqgilBK1Hf4Me6Sd_wY&callback=initMap"></script>
	</body>
</html>
